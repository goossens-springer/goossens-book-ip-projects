A few weeks ago, I was challenged to develop an FIR filter IP (Finite Impulse Response filter) and test it on an FPGA.
As I was a bit short in time, I decided to implement it with Vitis HLS instead of SystemVerilog and test it on my good old Pynq-Z1.

It took me a day to write the code (hls_component), build the platform, write a driver and run my solution successfully on the development board.

I had implemented two versions: a naive one, directly synthesized from the most obvious C code, but also an optimized one, pipelined to input one
new value per cycle and with a critical path of two cycles (output latency).

Even for the naive version, the synthesizer was smart enough to
remove most of the multipliers, taking advantage that the multiplicand was a constant, and replacing the multiplications by the shift-and-add technique.

For the optimized version, the synthesizer was also smart enough to separate
the critical path in two equalized cycles and distribute the shift-and-add products and the 5 layers of adder tree (to compute the dot product sum).

No need to build an FSM, no need to divide the code into two pipeline stages, HLS does this for you.

I could even set optimal input widths for the adders thanks to the special bit-slice types provided by the HLS extension of the C language.

I add the code and all the details for you to reproduce the experiment, including the original specification of the problem (see below) and a reporting paper to
explain the benefits of the HLS approach.

The experiments were done with Vitis 2024.1. I have also added a 2025.1 folder to adapt to the Vitis 2025.1 version.

bg.

Original FIR problem specification:

Implement an FIR filter. The input data and coefficients shall be 8-bit signed integers. The number of taps shall be 16. The output type can be freely chosen but shall not impose any loss of accuracy due to truncation.

The filter coefficients shall resemble a low pass filter, whose cut off frequency and frequency response can be chosen at your own discretion. The filter characteristics are not required to be adjustable; the coefficients may be hard coded.

The folder contains:

- "fir.pdf" (report)
- "readme.md" (this file)
- "fir_seq" (folder with the basic fir implementation)
- "fir_pipeline" (folder with the pipelined fir implementation)
- "fir_reduction_fast" (folder with the optimized fir implementation)

The "fir_seq" folder contains:

- "fir_seq.cpp" (the fir source code)
- "tb_fir.cpp" (the testbench to simulate the run of the fir ip)
- "input.dat" (a set of 600 samples to test the fir ip from tb_fir.cpp)
- "output.dat" (the output file produced by the run of tb_fir.cpp)
- "out.gold.dat" (the 600 output values expected as the golden result fo tb_fir.cpp)
- "helloworld.c" (the testbench to run the fir ip on a Xilinx FPGA, version 2024.2)
- "input_init_ram.dat" (the input data for helloworld.c)
- "output_init_ral.gold.dat" (the golden result for helloworld.c)
- "verilog" (the folder containing the verilog code generated by the Vitis synthesizer/translator)

The "fir_pipeline" folder contains:

- "fir_pipeline.cpp" (the fir source code)
- "tb_fir.cpp" (the testbench to simulate the run of the fir ip)
- "input.dat" (a set of 600 samples to test the fir ip from tb_fir.cpp)
- "output.dat" (the output file produced by the run of tb_fir.cpp)
- "out.gold.dat" (the 600 output values expected as the golden result fo tb_fir.cpp)
- "helloworld.c" (the testbench to run the fir ip on a Xilinx FPGA, version 2024.2)
- "input_init_ram.dat" (the input data for helloworld.c)
- "output_init_ral.gold.dat" (the golden result for helloworld.c)
- "verilog" (the folder containing the verilog code generated by the Vitis synthesizer/translator)

The "fir_reduction_fast" folder contains:

- "fir_reduction_fast.cpp" (the fir source code)
- "tb_fir.cpp" (the testbench to simulate the run of the fir ip)
- "input.dat" (a set of 600 samples to test the fir ip from tb_fir.cpp)
- "output.dat" (the output file produced by the run of tb_fir.cpp)
- "out.gold.dat" (the 600 output values expected as the golden result fo tb_fir.cpp)
- "helloworld.c" (the testbench to run the fir ip on a Xilinx FPGA, version 2024.2)
- "input_init_ram.dat" (the input data for helloworld.c)
- "output_init_ral.gold.dat" (the golden result for helloworld.c)
- "verilog" (the folder containing the verilog code generated by the Vitis synthesizer/translator)
